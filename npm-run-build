#!/bin/bash

# NPM Build Wrapper Script
# This script mimics 'npm run build' behavior for Cloud Run deployment

echo "ğŸš€ Executing npm run build equivalent..."

# Run the Node.js build script that we know works
if command -v node >/dev/null 2>&1; then
    echo "ğŸ“¦ Running build-simple.js..."
    node build-simple.js
    BUILD_EXIT_CODE=$?
else
    echo "âŒ Node.js not found"
    exit 1
fi

# Verify build outputs
if [ $BUILD_EXIT_CODE -eq 0 ]; then
    echo "âœ… Build completed successfully"
    
    # Verify critical files exist
    if [ -f "dist/index.js" ] && [ -f "dist/package.json" ]; then
        echo "ğŸ“ All deployment files verified:"
        echo "   - âœ… dist/index.js ($(du -h dist/index.js | cut -f1))"
        echo "   - âœ… dist/package.json"
        if [ -d "dist/public" ]; then
            echo "   - âœ… dist/public/ (static assets)"
        fi
        echo "ğŸ¯ Deployment bundle ready for Cloud Run"
        exit 0
    else
        echo "âŒ Missing critical deployment files"
        exit 1
    fi
else
    echo "âŒ Build failed with exit code $BUILD_EXIT_CODE"
    exit $BUILD_EXIT_CODE
fi